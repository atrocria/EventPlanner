from tkinter import messagebox, simpledialog
from .guestModel import save_guest_to_file, load_guests_from_file, rewrite_file

class GuestController:
    def __init__(self):
        self.guests = load_guests_from_file()

    def add_guest(self, name, rsvp):
        name = name.strip()
        if not name:
            messagebox.showerror("Error", "Guest name cannot be empty.")
            return False
        self.guests.append({"name": name, "rsvp": rsvp})
        save_guest_to_file(name, rsvp)
        messagebox.showinfo("Success", f"Guest added with RSVP: {rsvp}")
        return True

    def view_guests(self):
        if not self.guests:
            messagebox.showinfo("Guest List", "No guests added yet.")
            return
        guest_list_str = "\n".join(f"- {g['name']} (RSVP: {g['rsvp']})" for g in self.guests)
        messagebox.showinfo("Guest List", f"Total Guests: {len(self.guests)}\n\n{guest_list_str}")

    def remove_guest(self):
        if not self.guests:
            messagebox.showinfo("Info", "No guests to remove.")
            return
        names = [g["name"] for g in self.guests]
        choice = simpledialog.askstring("Remove Guest", f"Enter guest name to remove:\n{', '.join(names)}")
        if not choice:
            return
        for g in list(self.guests):
            if g["name"].lower() == choice.lower():
                self.guests.remove(g)
                rewrite_file(self.guests)
                messagebox.showinfo("Success", "Guest removed!")
                return
        messagebox.showerror("Error", "Guest not found!")